<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>unity3d NotificationCenter | A Programmer</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">unity3d NotificationCenter</h1><a id="logo" href="/.">A Programmer</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">unity3d NotificationCenter</h1><div class="post-meta">Feb 22, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h1 id="unity3d-NotificationCenter"><a href="#unity3d-NotificationCenter" class="headerlink" title="unity3d NotificationCenter"></a>unity3d NotificationCenter</h1><p>unity3d&#x4E2D;&#x7684;&#x4E8B;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x4F7F;&#x7528;cocos2dx&#x4E2D;&#x7684; Notification&#x547D;&#x540D;&#x3002;</p>
<p><strong>&#x4E8B;&#x4EF6;&#x4E00;&#x822C;&#x662F;&#x7531;&#x7EE7;&#x627F; MonoBehaviour &#x7684;Object&#x4F7F;&#x7528;&#x3002;&#x800C; MonoBehaviour &#x7EE7;&#x627F;&#x81EA; Behaviour&#xFF0C;Behaviour&#x7EE7;&#x627F;&#x81EA;Component&#xFF0C;&#x6240;&#x4EE5;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x4F20;&#x5165;&#x7684;&#x662F;Component&#x800C;&#x4E0D;&#x662F;GameObject&#x3002;</strong></p>
<p><a href="http://wiki.unity3d.com/index.php/NotificationCenterGenerics" target="_blank" rel="external">http://wiki.unity3d.com/index.php/NotificationCenterGenerics</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line">using UnityEngine;</div><div class="line">using System.Collections;</div><div class="line">using System.Collections.Generic;</div><div class="line">using System;</div><div class="line"> </div><div class="line">//    NotificationCenter is used for handling messages between GameObjects.</div><div class="line">//    GameObjects can register to receive specific notifications.  When another objects sends a notification of that type, all GameObjects that registered for it and implement the appropriate message will receive that notification.</div><div class="line">//    Observing GameObjects must register to receive notifications with the AddObserver function, and pass their selves, and the name of the notification.  Observing GameObjects can also unregister themselves with the RemoveObserver function.  GameObjects must request to receive and remove notification types on a type by type basis.</div><div class="line">//    Posting notifications is done by creating a Notification object and passing it to PostNotification.  All receiving GameObjects will accept that Notification object.  The Notification object contains the sender, the notification type name, and an option hashtable containing data.</div><div class="line">//    To use NotificationCenter, either create and manage a unique instance of it somewhere, or use the static NotificationCenter.</div><div class="line"> </div><div class="line">// We need a static method for objects to be able to obtain the default notification center.</div><div class="line">// This default center is what all objects will use for most notifications.  We can of course create our own separate instances of NotificationCenter, but this is the static one used by all.</div><div class="line">public class NotificationCenter : MonoBehaviour</div><div class="line">{</div><div class="line">	private static NotificationCenter defaultCenter;</div><div class="line">	public static NotificationCenter DefaultCenter () {</div><div class="line">	    // If the defaultCenter doesn&apos;t already exist, we need to create it</div><div class="line">	    if (!defaultCenter) {</div><div class="line">	        // Because the NotificationCenter is a component, we have to create a GameObject to attach it to.</div><div class="line">	        GameObject notificationObject = new GameObject(&quot;Default Notification Center&quot;);</div><div class="line">	        // Add the NotificationCenter component, and set it as the defaultCenter</div><div class="line">	        defaultCenter = notificationObject.AddComponent&lt;NotificationCenter&gt;();</div><div class="line">			DontDestroyOnLoad(defaultCenter);</div><div class="line">	    }</div><div class="line">	    return defaultCenter;</div><div class="line">	}</div><div class="line"> </div><div class="line">	// Our hashtable containing all the notifications.  Each notification in the hash table is an ArrayList that contains all the observers for that notification.</div><div class="line">	Hashtable notifications = new Hashtable();</div><div class="line"> </div><div class="line">	// AddObserver includes a version where the observer can request to only receive notifications from a specific object.  We haven&apos;t implemented that yet, so the sender value is ignored for now.</div><div class="line">	public void AddObserver (Component observer, String name) { AddObserver(observer, name, null); }</div><div class="line">	public void AddObserver (Component observer, String name, object sender) {</div><div class="line">	    // If the name isn&apos;t good, then throw an error and return.</div><div class="line">	    if (name == null || name == &quot;&quot;) { Debug.Log(&quot;Null name specified for notification in AddObserver.&quot;); return; }</div><div class="line">	    // If this specific notification doens&apos;t exist yet, then create it.</div><div class="line">		if (!notifications.ContainsKey(name)) {</div><div class="line">	        notifications[name] = new List&lt;Component&gt;();</div><div class="line">	    }</div><div class="line">//	    if (!notifications[name]) {</div><div class="line">//	        notifications[name] = new List&lt;Component&gt;();</div><div class="line">//	    }</div><div class="line"> </div><div class="line">	    List&lt;Component&gt; notifyList = (List&lt;Component&gt;)notifications[name];</div><div class="line"> </div><div class="line">	    // If the list of observers doesn&apos;t already contain the one that&apos;s registering, then add it.</div><div class="line">	    if (!notifyList.Contains(observer)) { notifyList.Add(observer); }</div><div class="line">	}</div><div class="line"> </div><div class="line">	// RemoveObserver removes the observer from the notification list for the specified notification type</div><div class="line">	public void RemoveObserver (Component observer, String name) {</div><div class="line">	    List&lt;Component&gt; notifyList = (List&lt;Component&gt;)notifications[name]; //change from original</div><div class="line"> </div><div class="line">	    // Assuming that this is a valid notification type, remove the observer from the list.</div><div class="line">	    // If the list of observers is now empty, then remove that notification type from the notifications hash.  This is for housekeeping purposes.</div><div class="line">	    if (notifyList != null) {</div><div class="line">	        if (notifyList.Contains(observer)) { notifyList.Remove(observer); }</div><div class="line">	        if (notifyList.Count == 0) { notifications.Remove(name); }</div><div class="line">	    }</div><div class="line">	}</div><div class="line"> </div><div class="line">	// PostNotification sends a notification object to all objects that have requested to receive this type of notification.</div><div class="line">	// A notification can either be posted with a notification object or by just sending the individual components.</div><div class="line">	public void PostNotification (Component aSender, String aName) { PostNotification(aSender, aName, null); }</div><div class="line">	public void PostNotification (Component aSender, String aName, object aData) { PostNotification(new Notification(aSender, aName, aData)); }</div><div class="line">	public void PostNotification (Notification aNotification) {</div><div class="line">	    // First make sure that the name of the notification is valid.</div><div class="line">	    if (aNotification.name == null || aNotification.name == &quot;&quot;) { Debug.Log(&quot;Null name sent to PostNotification.&quot;); return; }</div><div class="line">	    // Obtain the notification list, and make sure that it is valid as well</div><div class="line">	    List&lt;Component&gt; notifyList = (List&lt;Component&gt;)notifications[aNotification.name]; //change from original</div><div class="line">	    if (notifyList == null) { Debug.Log(&quot;Notify list not found in PostNotification.&quot;); return; }</div><div class="line"> </div><div class="line">	    // Clone list, so there won&apos;t be an issue if an observer is added or removed while notifications are being sent</div><div class="line">	    notifyList = new List&lt;Component&gt;(notifyList);</div><div class="line"> </div><div class="line">	    // Create an array to keep track of invalid observers that we need to remove</div><div class="line">	    List&lt;Component&gt; observersToRemove = new List&lt;Component&gt;(); //change from original</div><div class="line"> </div><div class="line">	    // Itterate through all the objects that have signed up to be notified by this type of notification.</div><div class="line">	    foreach (Component observer in notifyList) {</div><div class="line">	        // If the observer isn&apos;t valid, then keep track of it so we can remove it later.</div><div class="line">	        // We can&apos;t remove it right now, or it will mess the for loop up.</div><div class="line">	        if (!observer) { observersToRemove.Add(observer);</div><div class="line">	        } else {</div><div class="line">	            // If the observer is valid, then send it the notification.  The message that&apos;s sent is the name of the notification.</div><div class="line">	            observer.SendMessage(aNotification.name, aNotification, SendMessageOptions.DontRequireReceiver);</div><div class="line">	        }</div><div class="line">	    }</div><div class="line"> </div><div class="line">	    // Remove all the invalid observers</div><div class="line">	    foreach (Component observer in observersToRemove) {</div><div class="line">	        notifyList.Remove(observer);</div><div class="line">	    }</div><div class="line">	}</div><div class="line">}</div><div class="line"> </div><div class="line">// The Notification class is the object that is sent to receiving objects of a notification type.</div><div class="line">// This class contains the sending GameObject, the name of the notification, and optionally a hashtable containing data.</div><div class="line">public class Notification {</div><div class="line">    public Component sender;</div><div class="line">    public String name;</div><div class="line">    public object data;</div><div class="line"> </div><div class="line">    public Notification (Component aSender, String aName) { sender = aSender; name = aName; data = null; }</div><div class="line">    public Notification (Component aSender, String aName, object aData) { sender = aSender; name = aName; data = aData; }</div><div class="line">}</div></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/02/22/2017-02-22-unity3d NotificationCenter/" data-id="cizgb3cs9000kbuua6ox1ao4m" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Unity/">Unity</a><a href="/tags/Notification/">Notification</a></div><div class="post-nav"><a href="/2017/02/24/2017-02-24-游戏设计技术文档/" class="pre">游戏设计技术文档</a><a href="/2017/02/21/2017-02-21-Unity导出工程/" class="next">Unity导出工程</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Unity3d/">Unity3d</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Unity3d/" style="font-size: 15px;">Unity3d</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Big-Endian/" style="font-size: 15px;">Big Endian</a> <a href="/tags/Little-Endian/" style="font-size: 15px;">Little Endian</a> <a href="/tags/Endian/" style="font-size: 15px;">Endian</a> <a href="/tags/XUPorter/" style="font-size: 15px;">XUPorter</a> <a href="/tags/Unity/" style="font-size: 15px;">Unity</a> <a href="/tags/Notification/" style="font-size: 15px;">Notification</a> <a href="/tags/Manager/" style="font-size: 15px;">Manager</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/02/24/2017-02-24-游戏设计技术文档/">游戏设计技术文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/22/2017-02-22-unity3d NotificationCenter/">unity3d NotificationCenter</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/21/2017-02-21-Unity导出工程/">Unity导出工程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/17/2017-02-17-Git/">Git 常用总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/16/2017-02-16-大小端/">大小端相关</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/13/Build_IOS_FAQ/">Build_IOS_FAQ</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/12/XUPorterAbout/">XUPorter相关问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/25/unity3d_hotupdate/">unity3d下热更新相关</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/unity3d-Singleton/">unity3d_Singleton</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/20/Unity_BuildAssetBundleOptions/">Unity_BuildAssetBundleOptions</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">A Programmer.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>